<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Repositório Brasileiro Livre para Dados Abertos do Solo • febr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Repositório Brasileiro Livre para Dados Abertos do Solo">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">febr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Início</a>
</li>
<li>
  <a href="../articles/febr.html">Como usar</a>
</li>
<li>
  <a href="../reference/">Referência</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/febr-team/febr-package">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="febr_files/htmlwidgets-0.9/htmlwidgets.js"></script><script src="febr_files/jquery-1.12.4/jquery.min.js"></script><script src="febr_files/datatables-binding-0.2/datatables.js"></script><link href="febr_files/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="febr_files/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="febr_files/dt-core-1.10.12/js/jquery.dataTables.min.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Repositório Brasileiro Livre para Dados Abertos do Solo</h1>
                        <h4 class="author">Alessandro Samuel-Rosa</h4>
            
            <h4 class="date">20 Fevereiro 2018</h4>
          </div>

    
    
<div class="contents">
<div id="apresentacao" class="section level1">
<h1 class="hasAnchor">
<a href="#apresentacao" class="anchor"></a>Apresentação</h1>
<p>O Repositório Brasileiro Livre para Dados Abertos do Solo – <font face="Comfortaa">febr</font>, <a href="http://www.ufsm.br/febr/" class="uri">http://www.ufsm.br/febr/</a> – foi criado com o propósito de servir de plataforma para a compilação, organização e publicação de todos os tipos de dados do solo produzidos no Brasil. Para isso são usados padrões baseados em experiências internacionais, principalmente uma política de dados abertos, primando pela facilidade de acesso, manutenção e uso. A meta é constituir um repositório centralizado para armazenar e servir dados do solo em formato padronizado e harmonizado para várias aplicações. Estas incluem o desenvolvimento de bases de dados especializadas, a melhoria do Sistema Brasileiro de Classificação do Solo, a criação do Sistema Universal de Classificação do Solo, a construção de sistemas inteligentes de recomendação de fertilizantes, o desenvolvimento de experimentos agronômicos de larga escala espacial e temporal, e o suporte ao recém-lançado programa nacional de levantamento de solos (PronaSolos).</p>
<p>O uso de uma instalação centralizada de armazenamento e compartilhamento de dados do solo <font face="Comfortaa">febr</font> reduz os esforços duplicados de recuperação de dados do solo. Isso permite que os já escassos recursos existentes sejam usados de maneira mais racional para maximizar a colaboração entre cientistas do solo. No longo prazo, isso deve alavancar o avanço do conhecimento sobre o solo. Para facilitar ainda mais a reutilização dos dados publicados no <font face="Comfortaa">febr</font>, os cientistas do solo têm à sua disposição o pacote <code>febr</code> para o R.</p>
</div>
<div id="uso-do-pacote" class="section level1">
<h1 class="hasAnchor">
<a href="#uso-do-pacote" class="anchor"></a>Uso do pacote</h1>
<!-- A versão mais estável do pacote `febr` é distribuída via the *Comprehensive R Archive Network* (CRAN) e está disponível no endereço https://CRAN.R-project.org/package=febr. Sua instalação pode ser feita da seguinte maneira: -->
<!-- ```{r, eval=FALSE} -->
<!-- install.packages(pkgs = "febr") -->
<!-- ``` -->
<p>A versão atual de desenvolvimento do pacote <code>febr</code> está disponível no endereço <a href="https://github.com/febr-team/febr-package" class="uri">https://github.com/febr-team/febr-package</a>. Sua instalação pode ser feita – usando o pacote <code>devtools</code> – da seguinte maneira:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(devtools)) {
  <span class="kw">install.packages</span>(<span class="dt">pkgs =</span> <span class="st">"devtools"</span>)
}
devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="dt">repo =</span> <span class="st">"febr-team/febr-package"</span>)</code></pre></div>
<p>Depois de instalado, o pacote <code>febr</code> pode ser carregado para a sessão de trabalho no R usando o seguinte comando:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"febr"</span>)</code></pre></div>
<pre><code>## ---------------------------------------------------------------------
## Free Brazilian Repository for Open Soil Data 
## febr version 0.8-0 
## (built on 2018-02-25) is now loaded                      
##                                                                      
## Making the access to the Free Brazilian Repository for Open Soil Data
## as easy as possible. Access http://www.ufsm.br/febr/.                
## Contact febr-forum@googlegroups.com for more information             
## and to learn how you can help!                                       
## ---------------------------------------------------------------------</code></pre>
<pre><code>## 
## Attaching package: 'febr'</code></pre>
<pre><code>## The following object is masked from 'package:latticeExtra':
## 
##     layer</code></pre>
<p>O pacote <code>febr</code> possui três grupos de funções – veja tabela abaixo. As funções estruturais são usadas para descarregar informações sobre as tabelas de dados e os padrões usados no <font face="Comfortaa">febr</font>. As funções de acesso são usadas para descarregar dados dos conjuntos de dados publicados no <font face="Comfortaa">febr</font>. Já as funções auxiliares servem de apoio ao processamento e uso dos dados.</p>
<p>Nas próximas seções são demonstradas aplicações dessas funções usando conjuntos de dados reais publicados no <font face="Comfortaa">febr</font>.</p>
<table style="width:86%;" class="table">
<caption>Descrição sumária das funções do pacote <code>febr</code>.</caption>
<colgroup>
<col width="22%">
<col width="19%">
<col width="44%">
</colgroup>
<thead><tr class="header">
<th align="left">Função</th>
<th align="left">Grupo</th>
<th align="left">Descrição</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>header</code></td>
<td align="left">Estrutural</td>
<td align="left">Descarregar o cabeçalho das tabelas de dados</td>
</tr>
<tr class="even">
<td align="left"><code>standard</code></td>
<td align="left">Estrutural</td>
<td align="left">Descarregar os padrões de codificação e nomenclatura do <font face="Comfortaa">febr</font>
</td>
</tr>
<tr class="odd">
<td align="left"><code>unit</code></td>
<td align="left">Estrutural</td>
<td align="left">Descarregar os padrões de unidades de medida do <font face="Comfortaa">febr</font>
</td>
</tr>
<tr class="even">
<td align="left"><code>dataset</code></td>
<td align="left">De trabalho</td>
<td align="left">Descarregar informações gerais sobre um conjunto de dados</td>
</tr>
<tr class="odd">
<td align="left"><code>observation</code></td>
<td align="left">De trabalho</td>
<td align="left">Descarregar dados das observações do solo de um conjunto de dados</td>
</tr>
<tr class="even">
<td align="left"><code>layer</code></td>
<td align="left">De trabalho</td>
<td align="left">Descarregar dados das camadas das observações do solo de um conjunto de dados</td>
</tr>
<tr class="odd">
<td align="left"><code>metadata</code></td>
<td align="left">De trabalho</td>
<td align="left">Descarregar metadados de um conjunto de dados</td>
</tr>
<tr class="even">
<td align="left"><code>febr</code></td>
<td align="left">De trabalho</td>
<td align="left">Descarregar todos os dados e metadados de um conjunto de dados</td>
</tr>
<tr class="odd">
<td align="left">febr2sp</td>
<td align="left">Auxiliar</td>
<td align="left">Criar objeto de classe <code>SpatialPointsDataFrame</code>.</td>
</tr>
<tr class="even">
<td align="left">febr2xlsx</td>
<td align="left">Auxiliar</td>
<td align="left">Escrever dados para arquivo XLSX.</td>
</tr>
</tbody>
</table>
<div id="funcoes-estruturais" class="section level2">
<h2 class="hasAnchor">
<a href="#funcoes-estruturais" class="anchor"></a>Funções estruturais</h2>
<p>As funções estruturais servem para conhecer a estrutura das tabelas dos conjuntos de dados publicados no <font face="Comfortaa">febr</font>. Elas também servem para conhecer os padrões de codificação, nomenclatura, unidades de medida e número de casas decimais usados no <font face="Comfortaa">febr</font>.</p>
<div id="cabecalho-das-tabelas" class="section level3">
<h3 class="hasAnchor">
<a href="#cabecalho-das-tabelas" class="anchor"></a>Cabeçalho das tabelas</h3>
<p>A função <code>header</code> serve para descarregar o cabeçalho – as duas primeiras linhas – de uma das duas tabelas de dados – <code>observacao</code> ou <code>camada</code> – de um conjunto de dados publicado no <font face="Comfortaa">febr</font>. Isso permite verificar quais são as variáveis incluídas num determinado conjunto de dados, os códigos de identificação utilizados, e as respectivas unidades de medida. Por exemplo, o cabeçalho da tabela <code>camada</code> do conjunto de dados <code>ctb0003</code> é o seguinte:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cab &lt;-<span class="st"> </span>
<span class="st">  </span>febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/header">header</a></span>(
    <span class="dt">dataset =</span> <span class="st">"ctb0003"</span>, 
    <span class="dt">table =</span> <span class="st">"camada"</span>, 
    <span class="dt">variable =</span> <span class="st">"all"</span>,
    <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">t</span>() 
cab </code></pre></div>
<pre><code>##                                 [,1]      
## dataset_id                      "ctb0003" 
## observacao_id                   "-"       
## camada_numero                   "-"       
## camada_nome                     "-"       
## amostra_codigo                  "-"       
## profund_sup                     "cm"      
## profund_inf                     "cm"      
## areia_naoh_esferas_peneira      "g/kg"    
## argila_naoh_esferas_pipeta      "g/kg"    
## calcio_kcl_eaa                  "cmolc/kg"
## magnesio_kcl_eaa                "cmolc/kg"
## acidez_kcl_naoh                 "cmolc/kg"
## potassio_mehlich1_eeac          "cmolc/kg"
## sodio_mehlich1_eeac             "cmolc/kg"
## carbono_dicromato_30min150_mohr "g/kg"    
## densidade_solo_anel             "Mg/m^3"  
## cascalho_olho                   "%"</code></pre>
<p>No código acima, o argumento <code>variable = "all"</code> faz com que o cabeçalho descarregado inclua todas as variáveis contidas na tabela <code>camada</code> do conjunto de dados <code>ctb0003</code>. Do contrário, se o argumento <code>variable</code> for deixado em branco, apenas um subconjunto de variáveis de identificação é descarregado, especificamente as sete primeiras variáveis: <code>dataset_id</code>, <code>observacao_id</code>, <code>camada_numero</code>, <code>camada_nome</code>, <code>amostra_codigo</code>, <code>profund_sup</code> e <code>profund_inf</code>.</p>
<p>Também é possível descarregar o cabeçalho de uma tabela de dados de dois ou mais conjuntos de dados. Para isso basta informar o código dos conjuntos de dados usando o argumento <code>dataset</code>. Nesse caso, o argumento <code>stack</code> pode ser usado para solicitar que os cabeçalhos dos conjuntos de dados sejam empilhados, o que resulta como saída um único objeto de classe <code>data.frame</code>. Do contrário, a função retorna um objeto de classe <code>list</code>, no qual cada cada cabeçalho consiste em um item individual. Por exemplo, o empilhamento do cabeçalho da tabela <code>camada</code> dos conjuntos de dados <code>ctb0003</code> e <code>ctb0036</code> é feito da seguinte maneira:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/header">header</a></span>(
  <span class="dt">dataset =</span> <span class="kw">c</span>(<span class="st">"ctb0003"</span>, <span class="st">"ctb0036"</span>),
  <span class="dt">table =</span> <span class="st">"camada"</span>,
  <span class="dt">variable =</span> <span class="kw">c</span>(<span class="st">"argila"</span>, <span class="st">"densidade"</span>, <span class="st">"carbono"</span>, <span class="st">"ph"</span>),
  <span class="dt">stack =</span> <span class="ot">TRUE</span>, <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">t</span>()</code></pre></div>
<pre><code>##                                 [,1]      [,2]     
## dataset_id                      "ctb0003" "ctb0036"
## observacao_id                   "-"       "-"      
## camada_numero                   "-"       "-"      
## camada_nome                     "-"       "-"      
## amostra_codigo                  "-"       "-"      
## profund_sup                     "cm"      "cm"     
## profund_inf                     "cm"      "cm"     
## argila_naoh_esferas_pipeta      "g/kg"    "g/kg"   
## densidade_solo_anel             "Mg/m^3"  "Mg/m^3" 
## carbono_dicromato_30min150_mohr "g/kg"    "g/kg"   
## ph_h2o_25                       NA        "-"</code></pre>
<p>O código acima mostra que a função <code>header</code> também permite selecionar as variáveis de interesse usando o argumento <code>variable</code>. Nesse caso, vemos que ambos os conjuntos de dados possuem as variáveis <code>argila</code>, <code>densidade</code> e <code>carbono</code>, mas que apenas o conjunto de dados <code>ctb0036</code> inclui a variável <code>ph</code> – o valor <code>NA</code> foi retornado para <code>ctb0003</code>. Essas informações serão importantes mais tarde quando os dados desses dois conjuntos de dados forem descarregados usando a função <code>layer</code>. De antemão, sabemos que os dois conjuntos de dados compartilham apenas algumas variáveis – <code>argila</code>, <code>densidade</code> e <code>carbono</code> estão entre elas.</p>
</div>
<div id="padroes" class="section level3">
<h3 class="hasAnchor">
<a href="#padroes" class="anchor"></a>Padrões</h3>
<p>A função <code>standard</code> fornece uma interface para descarregar informações sobre os padrões usados para as variáveis incluídas nas tabelas <code>observacao</code> e <code>camada</code> dos conjuntos de dados publicados no <font face="Comfortaa">febr</font>. Isso inclui a codificação e nomenclatura, a descrição de cada variável, a unidade de medida e o número de casas decimais, o tipo de dado, e a categoria da variável. Para as quatro variáveis usadas acima, a codificação, nomenclatura e descrição são as seguintes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/standard">standard</a></span>(
  <span class="dt">variable =</span> <span class="kw">c</span>(<span class="st">"argila"</span>, <span class="st">"densidade"</span>, <span class="st">"carbono"</span>, <span class="st">"ph"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(campo_id, campo_nome, campo_descricao) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pander</span>(<span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre></div>
<table class="table">
<colgroup>
<col width="34%">
<col width="32%">
<col width="32%">
</colgroup>
<thead><tr class="header">
<th align="left">campo_id</th>
<th align="left">campo_nome</th>
<th align="left">campo_descricao</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">argila_xxx_xxx_xxx</td>
<td align="left">Argila total</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">argila_naoh_esferas_pipeta</td>
<td align="left">Argila total</td>
<td align="left">Argila total (&lt; 0,002 mm). Dispersão química com hidróxido de sódio [naoh] na concentração de 1 mol/L. Dispersão mecânica por agitação horizontal por quatro horas com esferas de nylon [esferas]. Quantificação pelo método da pipeta.</td>
</tr>
<tr class="odd">
<td align="left">argila_h20</td>
<td align="left">Argila dispersa em água</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">densidade_particula_xxx</td>
<td align="left">Densidade de partícula</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">densidade_solo_xxx</td>
<td align="left">Densidade do solo</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">densidade_solo_anel</td>
<td align="left">Densidade do solo</td>
<td align="left">Desidade do solo. Amostragem usando anel metálico. Quantificação com balança de precisão.</td>
</tr>
<tr class="odd">
<td align="left">densidade_aliquota</td>
<td align="left">Densidade da alíquota de solo</td>
<td align="left">Densidade da alíquota de solo. Densidade do volume de material usado para uma determinada análise laboratorial.</td>
</tr>
<tr class="even">
<td align="left">carbono_dicromato_30min150_mohr</td>
<td align="left">Carbono orgânico</td>
<td align="left">Carbono orgânico. Oxidação via digestão úmida usando solução sulfocrômica [K2Cr2O7 + H2SO4] 0,067 mol/L em um bloco de digestão a 150 ºC durante 30 min. A solução foi titulada usando sulfato ferroso amoniacal [Fe(NH4)2(SO4)2.6H2O] 0,1 mol/L. Esse método é conhecido como Mebius no bloco, proposto por Yeomans &amp; Bremner (1988).</td>
</tr>
<tr class="odd">
<td align="left">carbono_fornalha_1min950_cgdct</td>
<td align="left">Carbono total</td>
<td align="left">Carbono total. Oxidação via combustão seca em fornalha à temperatura de 950°C, na presença de oxigênio e óxido de cromo, por 1 min, e determinação por cromatografia gasosa (CG) usando um detector por condutividade térmica (DCT). Esse método é comumente conhecido como o ‘método do autoanalisador’.</td>
</tr>
<tr class="even">
<td align="left">carbono_fornalha_xxx_xxx</td>
<td align="left">Carbono total</td>
<td align="left">Carbono total. Oxidação via combustão seca em fornalha.</td>
</tr>
<tr class="odd">
<td align="left">carbono_walkleyblack</td>
<td align="left">Carbono orgânico</td>
<td align="left">Conteúdo de carbono orgânico determinado usando o método de combustão úmida de Walkley-Black</td>
</tr>
<tr class="even">
<td align="left">carbono_xxx_xxx_xxx</td>
<td align="left">Carbono orgânico</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">carbono_sobre_nitrogenio</td>
<td align="left">Razão carbono / nitrogênio</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">ph_cacl2</td>
<td align="left">pH em CaCl2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">ph_h2o</td>
<td align="left">pH em água</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">ph_h2o_25</td>
<td align="left">pH em água</td>
<td align="left">Potencial hidrogeniônico. Determinação em água utilizando relação solo-água de 1:2,5 [25].</td>
</tr>
<tr class="odd">
<td align="left">ph_kcl</td>
<td align="left">pH em KCl</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>O resultado da função <code>standard</code> mostra que existem inúmeras variáveis cuja codificação inicia com os termos <code>argila</code>, <code>densidade</code>, <code>carbono</code> e <code>ph</code>. Na maioria dos casos, a nomenclatura é a mesma. Contudo, a descrição de cada variável mostra que foram obtidas utilizando métodos laboratoriais mais ou menos distintos. Se for do nosso interesse retornar apenas as informações de variáveis específicas, então basta passar para o argumento <code>variable</code> seu código de identificação completo, por exemplo, <code>ph_h2o_25</code>.</p>
<p>Cabe destacar que, para algumas variáveis, a codificação e/ou a nomenclatura e/ou a descrição está(ão) incompleta(s). Na maioria dos casos, isso ocorre porque as variáveis aguardam pela revisão de consultores externos. Mas para algumas variáveis, a incompletude ocorre devido ao uso de codificação temporária, que será alterada num futuro próximo. As pessoas interessadas em auxiliar devem acessar a planilha <a href="https://goo.gl/hi77sB" class="uri">https://goo.gl/hi77sB</a> ou enviar mensagem de e-mail para o endereço <a href="mailto:febr-forum@googlegroups.com">febr-forum@googlegroups.com</a>.</p>
</div>
<div id="unidades-de-medida" class="section level3">
<h3 class="hasAnchor">
<a href="#unidades-de-medida" class="anchor"></a>Unidades de medida</h3>
<p>Acima, a função <code>header</code> serviu para conhecermos as variáveis contidas nos conjuntos de dados <code>ctb0003</code> e <code>ctb0036</code>, e suas respectivas unidades de medida. Todas as variáveis compartilhadas pelos dois conjuntos de dados possuem as mesmas unidades de medida: <code>g/kg</code> para <code>argila</code> e <code>carbono</code>, e <code>Mg/m^3</code> para <code>densidade</code>. Abaixo, vemos que a unidade de medida padrão para a <code>argila</code> e <code>carbono</code> é <code>g/kg</code>, e que <code>ph</code> não possui unidade de medida. Contudo, no caso da <code>densidade</code>, a unidade de medida padrão é <code>kg/dm^3</code> – ao invés de <code>Mg/m^3</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/standard">standard</a></span>(
  <span class="dt">variable =</span> <span class="kw">c</span>(
    <span class="st">"argila_naoh_esferas_pipeta"</span>, <span class="st">"densidade_solo_anel"</span>, <span class="st">"carbono_dicromato_30min150_mohr"</span>, <span class="st">"ph_h2o_25"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(campo_id, campo_unidade, campo_precisao) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pander</span>()</code></pre></div>
<table style="width:92%;" class="table">
<colgroup>
<col width="47%">
<col width="22%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left">campo_id</th>
<th align="left">campo_unidade</th>
<th align="left">campo_precisao</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">argila_naoh_esferas_pipeta</td>
<td align="left">g/kg</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">densidade_solo_anel</td>
<td align="left">kg/dm^3</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">carbono_dicromato_30min150_mohr</td>
<td align="left">g/kg</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">ph_h2o_25</td>
<td align="left">NA</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<p>A função <code>unit</code> serve de interface para uma tabela contendo diversas unidades de medida e as constantes utilizadas para a conversão dos dados entre elas. No caso da variável <code>densidade</code>, a constante de transformação é igual a <code>1</code>. Isso significa que os valores expressos em <code>Mg/m^3</code> são equivalentes aos expressos em <code>kg/dm^3</code>. Essa informação será útil mais tarde quando formos descarregar os dados desses dois conjuntos de dados usando a função <code>layer</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/unit">unit</a></span>(<span class="dt">source =</span> <span class="st">"Mg/m^3"</span>, <span class="dt">target =</span> <span class="st">"kg/dm^3"</span>)</code></pre></div>
<pre><code>##   unidade_origem unidade_destino unidade_constante unidade_descricao
## 1         Mg/m^3         kg/dm^3                 1        Densidade;</code></pre>
<p>A seguir são mostradas todas as unidades de medida e constantes de transformação disponíveis no <font face="Comfortaa">febr</font>. Adições podem ser feitas na forma de proposições diretamente na planilha <a href="https://goo.gl/Vvvsf2" class="uri">https://goo.gl/Vvvsf2</a> ou via mensagem de e-mail para o endereço <a href="mailto:febr-forum@googlegroups.com">febr-forum@googlegroups.com</a>.</p>
<div id="htmlwidget-43b71e67c50f6cdff8c3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-43b71e67c50f6cdff8c3">{"x":{"filter":"none","data":[["%","%","%","%","dag/kg","dag/kg","dag/kg","dag/kg","dm","g/cg","g/cg","g/cm^3","g/cm^3","g/kg","g/kg","g/kg","kg/dm^3","kg/dm^3","kg/kg","km","m","mg/dm^3","mg/dm^3","mg/kg","mg/kg","mg/kg","mg/kg","Mg/m^3","Mg/m^3","mmolc/kg","ppm","kPa","kPa","kPa","kPa","Bar","Bar","Bar","Bar","mca","mca","mca","mca","mm Hg","mm Hg","mm Hg","mm Hg","PSI","PSI","PSI","PSI"],["mg/kg","g/kg","g/cg","kg/kg","mg/kg","g/kg","%","kg/kg","cm","kg/kg","%","kg/dm^3","Mg/m^3","mg/kg","%","dag/kg","Mg/m^3","g/cm^3","g/cg","m","cm","mg/kg","g/kg","ppm","g/kg","dag/kg","%","kg/dm^3","g/cm^3","cmolc/kg","mg/kg","Bar","mca","mm Hg","PSI","kPa","mca","mm Hg","PSI","kPa","Bar","mm Hg","PSI","kPa","Bar","mca","PSI","kPa","Bar","mca","mm Hg"],[10000,10,1,0.01,10000,10,1,0.01,10,0.01,1,1,1,1000,0.1,0.1,1,1,100,1000,100,1,0.001,1,0.001,0.0001,0.0001,1,1,0.1,1,98,9.8,0.1333,6.8947,0.0102,0.1,0.0014,0.0704,0.102,10,0.0136,0.7035,7.5006,735.06,73.506,51.7149,0.14503,14.2137,1.4214,0.0193]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Unidade de origem<\/th>\n      <th>Unidade de destino<\/th>\n      <th>Constante de transformação<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"language":{"url":"//cdn.datatables.net/plug-ins/1.10.11/i18n/Portuguese-Brasil.json"},"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="funcoes-de-acesso" class="section level2">
<h2 class="hasAnchor">
<a href="#funcoes-de-acesso" class="anchor"></a>Funções de acesso</h2>
<p>As funções de acesso servem para efetivamente descarregar os dados dos conjuntos de dados publicados no <font face="Comfortaa">febr</font>.</p>
<div id="metadados" class="section level3">
<h3 class="hasAnchor">
<a href="#metadados" class="anchor"></a>Metadados</h3>
<p>Os dados sobre um conjunto de dados publicado no <font face="Comfortaa">febr</font>, contidos na tabela <code>dataset</code>, podem ser descarregados usando uma função de mesmo nome. Por exemplo, o conteúdo da tabela <code>dataset</code> do conjunto de dados <code>ctb0003</code> é o seguinte:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/dataset">dataset</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0003"</span>, <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pandoc.table</span>(
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">caption =</span> <span class="st">"Dados sobre o conjunto de dados `ctb0003` contidos na tabela  `dataset`."</span>)</code></pre></div>
<table class="table">
<caption>Dados sobre o conjunto de dados <code>ctb0003</code> contidos na tabela <code>dataset</code>.</caption>
<colgroup>
<col width="22%">
<col width="77%">
</colgroup>
<thead><tr class="header">
<th align="left">campo</th>
<th align="left">valor</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">dataset_id</td>
<td align="left">ctb0003</td>
</tr>
<tr class="even">
<td align="left">dataset_titulo</td>
<td align="left">Conjunto de dados do solo da bacia do reservatório do DNOS-CORSAN, Santa Maria, RS</td>
</tr>
<tr class="odd">
<td align="left">dataset_descricao</td>
<td align="left">Compreende dados do solo de n = 400 observações feitas entre 2009 e 2013 na bacia do reservatório do Departamento Nacional de Obras de Saneamento-Companhia Riograndense de Saneamento (DNOS-CORSAN), localizada no estado brasileiro do Rio Grande do Sul. Esses dados do solo foram produzidos no âmbito de projetos de pesquisa que visam a produção de mapas semi-detalhados do solo e do uso da terra, e prever o estoque superficial de carbono no solo e sua vulnerabilidade à erosão. Todos os locais de observação foram selecionados intencionalmente ou por conveniência. Várias características ambientais foram descritas nos locais de observação, tais como o uso da terra, geologia, classificação do solo, declividade, condições de drenagem, presença de fragmentos grosseiros e afloramentos rochosos, cobertura do solo com vegetação, entre outras peculiaridades de cada local de observação que não foram registradas de uma forma sistemática. As amostras do solo foram submetidos à análise de laboratório para determinar o conteúdo de carbono orgânico no solo, a distribuição do tamanho de partículas, a densidade e o conteúdo de bases (cálcio, magnésio, potássio e sódio) e acidez trocáveis. A capacidade de troca de cátions efetiva foi calculada como a soma das bases e acidez trocáveis. Eles incluem a identificação de todos os locais de observação, as suas coordenadas geográficas, e dados de campo e de laboratório. O número de repetições de laboratório e o desvio padrão amostral também são fornecidos.</td>
</tr>
<tr class="even">
<td align="left">dataset_versao</td>
<td align="left">2.1</td>
</tr>
<tr class="odd">
<td align="left">dataset_licenca</td>
<td align="left">CC BY 4.0</td>
</tr>
<tr class="even">
<td align="left">publicacao_data</td>
<td align="left">17-01-2018</td>
</tr>
<tr class="odd">
<td align="left">organizacao_nome</td>
<td align="left">Universidade Federal de Santa Maria (UFSM)</td>
</tr>
<tr class="even">
<td align="left">organizacao_url</td>
<td align="left"><a href="http://site.ufsm.br/" class="uri">http://site.ufsm.br/</a></td>
</tr>
<tr class="odd">
<td align="left">organizacao_pais_id</td>
<td align="left">Brasil</td>
</tr>
<tr class="even">
<td align="left">organizacao_municipio_id</td>
<td align="left">Santa Maria</td>
</tr>
<tr class="odd">
<td align="left">organizacao_codigo_postal</td>
<td align="left">97105-900</td>
</tr>
<tr class="even">
<td align="left">organizacao_rua_nome</td>
<td align="left">Av. Roraima</td>
</tr>
<tr class="odd">
<td align="left">organizacao_rua_numero</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">autor_nome</td>
<td align="left">Alessandro Samuel-Rosa; Pablo Miguel; Jean Michel Moura-Bueno; Andrisa Balbinot; Ricardo Simão Diniz Dalmolin; Lúcia Helena Cunha dos Anjos</td>
</tr>
<tr class="odd">
<td align="left">autor_email</td>
<td align="left"><a href="mailto:alessandrosamuelrosa@gmail.com">alessandrosamuelrosa@gmail.com</a></td>
</tr>
<tr class="even">
<td align="left">dataset_referencia_1</td>
<td align="left"><a href="http://dx.doi.org/10.1590/S0100-06832013000200013" class="uri">http://dx.doi.org/10.1590/S0100-06832013000200013</a></td>
</tr>
<tr class="odd">
<td align="left">dataset_referencia_2</td>
<td align="left"><a href="http://w3.ufsm.br/ppgcs/images/Dissertacoes/ALESSANDRO-SAMUEL-ROSA.pdf" class="uri">http://w3.ufsm.br/ppgcs/images/Dissertacoes/ALESSANDRO-SAMUEL-ROSA.pdf</a></td>
</tr>
<tr class="even">
<td align="left">dataset_referencia_3</td>
<td align="left"><a href="http://dx.doi.org/10.1016/j.geoderma.2014.12.017" class="uri">http://dx.doi.org/10.1016/j.geoderma.2014.12.017</a></td>
</tr>
<tr class="odd">
<td align="left">dataset_referencia_4</td>
<td align="left"><a href="http://www.ia.ufrrj.br/cpacs/arquivos/teses_dissert/422_(DO-2016)_Alessandro_Samuel_Rosa.pdf" class="uri">http://www.ia.ufrrj.br/cpacs/arquivos/teses_dissert/422_(DO-2016)_Alessandro_Samuel_Rosa.pdf</a></td>
</tr>
<tr class="even">
<td align="left">area_conhecimento</td>
<td align="left">Gênese, Morfologia e Classificação dos Solos</td>
</tr>
<tr class="odd">
<td align="left">palavras_chave</td>
<td align="left">Mapeamento digital do solo; Pedometria; Amostragem intencional; Descrição do solo no campo</td>
</tr>
<tr class="even">
<td align="left">categoria_vcge</td>
<td align="left">Pesquisa científica e tecnologia</td>
</tr>
</tbody>
</table>
<p>Uma das informações mais importantes contida na tabela <code>dataset</code> é a licença de uso do conjunto de dados (<code>dataset_licenca</code>). No caso de <code>ctb0003</code>, a licença de uso é [CC BY 4.0][cby], o que significa que o conjunto de dados pode ser distribuído, remixado, adaptado e usado para criar outros produtos, mesmo que para fins comerciais, desde que seja atribuído o devido crédito aos autores (<code>autor_nome</code>) do conjunto de dados original. A tabela <code>dataset</code> inclui ainda links para as publicações (<code>dataset_referencia_i</code>) onde o conjunto de dados foi inicialmente utilizado. Isso permite obter mais informações sobre o conjunto de dados caso aquelas contidas na tabela <code>dataset</code> se mostrem insuficientes e, também, para dar os devidos créditos aos seus autores.</p>
<p>Os dados sobre os dados contidos em um conjunto de dados, armazenados na tabela <code>metadado</code>, podem ser descarregados usando a função <code>metadata</code>. Por exemplo, o conteúdo (parcial) da tabela <code>metadado</code> do conjunto de dados <code>ctb0003</code> é o seguinte:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2001</span>)
febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/metadata">metadata</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0003"</span>, <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, tabela_id, campo_id, campo_nome, campo_descricao) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(tabela_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pandoc.table</span>(
    <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">caption =</span> <span class="st">"Alguns dos dados sobre os dados contidos no conjunto de dados `ctb0003`."</span>)</code></pre></div>
<table class="table">
<caption>Alguns dos dados sobre os dados contidos no conjunto de dados <code>ctb0003</code>.</caption>
<colgroup>
<col width="12%">
<col width="12%">
<col width="20%">
<col width="25%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th align="left">dataset_id</th>
<th align="left">tabela_id</th>
<th align="left">campo_id</th>
<th align="left">campo_nome</th>
<th align="left">campo_descricao</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ctb0003</td>
<td align="left">camada</td>
<td align="left">sodio_mehlich1_eeac</td>
<td align="left">Sódio trocável</td>
<td align="left">Sódio trocável. Extração com solução de ácido clorídrico (HCl) na concentração de 0,05 mol/L e ácido sulfúrico (H2SO4) na concentração de 0,025 mol/L (Mehlich-I) [mehlich1]. Quantificação por espectrometria de emissão atômica em chama [eeac].</td>
</tr>
<tr class="even">
<td align="left">ctb0003</td>
<td align="left">camada</td>
<td align="left">magnesio_kcl_eaa</td>
<td align="left">Magnésio trocável</td>
<td align="left">Magnésio trocável. Extração com cloreto de potássio [kcl] na concentração de 1 mol/L. Quantificação por espectroscopia de absorção atômica [eaa].</td>
</tr>
<tr class="odd">
<td align="left">ctb0003</td>
<td align="left">camada</td>
<td align="left">amostra_codigo</td>
<td align="left">Código da amostra</td>
<td align="left">Código laboratorial da amostra. Usado para identificar as repetições de laboratório. Usar 1 se não houver repetição ou código laboratorial específico.</td>
</tr>
<tr class="even">
<td align="left">ctb0003</td>
<td align="left">camada</td>
<td align="left">camada_nome</td>
<td align="left">Nome da camada</td>
<td align="left">Nome da camada ou horizonte. Exemplo: A, B, C, etc.</td>
</tr>
<tr class="odd">
<td align="left">ctb0003</td>
<td align="left">camada</td>
<td align="left">camada_numero</td>
<td align="left">Número da camada</td>
<td align="left">Número da camada ou horizonte na observação, atribuído consecutivamente de cima para baixo.</td>
</tr>
<tr class="even">
<td align="left">ctb0003</td>
<td align="left">observacao</td>
<td align="left">estado_id</td>
<td align="left">Unidade federativa</td>
<td align="left">Sigla da unidade da federação onde a observação foi realizada. RS para o Rio Grande do Sul.</td>
</tr>
<tr class="odd">
<td align="left">ctb0003</td>
<td align="left">observacao</td>
<td align="left">terra_usoatual</td>
<td align="left">Uso atual da terra</td>
<td align="left">Uso atual da terra</td>
</tr>
<tr class="even">
<td align="left">ctb0003</td>
<td align="left">observacao</td>
<td align="left">coord_precisao</td>
<td align="left">Precisão das coordenadas</td>
<td align="left">Precisão com que as coordenadas espaciais foram determinadas.</td>
</tr>
<tr class="odd">
<td align="left">ctb0003</td>
<td align="left">observacao</td>
<td align="left">taxon_sibcs_2009</td>
<td align="left">Classificação taxonômica</td>
<td align="left">Nome da classificação da observação de acordo com o Sistema Brasileiro de Classificação do Solo (sibcs) de 2009.</td>
</tr>
<tr class="even">
<td align="left">ctb0003</td>
<td align="left">observacao</td>
<td align="left">coord_fonte</td>
<td align="left">Fonte das coordenadas</td>
<td align="left">Fonte das coordenadas. GPS, se as coordenadas vêm de um GPS, MAPA, se as coordenadas vêm de um mapa, WEB, se as coordenadas vêm de um serviço web como o Google Maps.</td>
</tr>
</tbody>
</table>
<p>As definições contidas na tabela <code>metadado</code> podem ser verificadas usando a função <code>standard</code> descrita mais acima.</p>
</div>
<div id="observacoes" class="section level3">
<h3 class="hasAnchor">
<a href="#observacoes" class="anchor"></a>Observações</h3>
<p>Os dados das observações do solo, contidos na tabela <code>observacao</code> de um conjunto de dados, podem ser descarregados usando a função <code>observation</code>. Assim como as funções <code>header</code> e <code>standard</code> vistas acima, a função <code>observation</code> também possui o argumento <code>variable</code>, que permite selecionar as variáveis que devem ser retornadas.</p>
<p>Antes de descarregar a tabela <code>observacao</code> do conjunto de dados <code>ctb0003</code>, vamos usar a função <code>header</code> para conhecer o seu conteúdo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/header">header</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0003"</span>, 
  <span class="dt">table =</span> <span class="st">"observacao"</span>, 
  <span class="dt">variable =</span> <span class="st">"all"</span>,
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">t</span>()</code></pre></div>
<pre><code>##                      [,1]     
## dataset_id           "ctb0003"
## observacao_id        "-"      
## observacao_data      "-"      
## coord_sistema        "-"      
## coord_x              "°"      
## coord_y              "°"      
## coord_precisao       "m"      
## coord_fonte          "-"      
## pais_id              "-"      
## estado_id            "-"      
## municipio_id         "-"      
## amostra_tipo         "-"      
## amostra_quanti       "-"      
## amostra_area         "m^2"    
## taxon_sibcs_2009     "-"      
## terra_usoatual       "-"      
## geo_parental         "-"      
## geo_formacao         "-"      
## geo_litologia        "-"      
## relevo_declividade   "%"      
## relevo_drenagem      "-"      
## geo_pedregosidade_k2 "-"      
## geo_rochosidade_k2   "-"      
## fito_cobertura       "-"      
## observacao_autor     "-"</code></pre>
<p>Agora que conhecemos as variáveis contidas na tabela <code>observacao</code> do conjunto de dados <code>ctb0003</code>, é possível proceder com seu descarregamento usando a função <code>observation</code>. Vamos solicitar que seja retornada apenas a variável <code>taxon</code> para, em seguida, após criar um objeto de classe <code>SpatialPointsDataFrame</code> com a função <code>febr2sp</code>, visualizar sua distribuição espacial usando a função <code>spplot</code> do pacote <code>sp</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/observation">observation</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0003"</span>,
  <span class="dt">variable =</span> <span class="st">"taxon"</span>,
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/febr2sp.html">febr2sp</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spplot</span>(<span class="dt">zcol =</span> <span class="st">"taxon_sibcs_2009"</span>, <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">columns =</span> <span class="dv">3</span>), <span class="dt">scales =</span> <span class="kw">list</span>(<span class="dt">draw =</span> <span class="ot">TRUE</span>)) <span class="op">+</span>
<span class="st">  </span>latticeExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/latticeExtra/topics/layer">layer</a></span>(<span class="kw">panel.grid</span>(<span class="dt">v =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">h =</span> <span class="op">-</span><span class="dv">1</span>))</code></pre></div>
<p><img src="febr_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>Um argumento bastante útil da função <code>observation</code> é <code>missing</code>. Esse argumento aceita uma lista contendo especificações sobre como proceder caso alguma das observações não possua coordenadas espaciais (<code>coord</code>), data de observação (<code>time</code>), ou dados para uma ou mais das demais variáveis (<code>data</code>). O comportamento padrão do argumento <code>missing</code> consiste em retornar todas as observações, independentemente de possuírem ou não quaisquer dados. Alternativamente, pode-se solicitar que apenas as observações com dados sejam retornadas. Isso seria necessário, por exemplo, para o tratamento espacial dos dados do conjunto de dados <code>ctb0036</code>, que não possui coordenadas espaciais para algumas das suas observações. O valor <code>coord = "drop"</code> precisa ser passado para o argumento <code>missing</code> para que as observações sem coordenadas espaciais sejam excluídas – definição equivalente é usada para excluir observações sem data de observação – <code>time = "drop"</code> – ou dados para uma ou mais variáveis – <code>data = "drop"</code>. Vejamos a seguir como proceder:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/observation">observation</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0036"</span>,
  <span class="dt">missing =</span> <span class="kw">list</span>(<span class="dt">coord =</span> <span class="st">"drop"</span>, <span class="dt">time =</span> <span class="st">"drop"</span>),
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/febr2sp.html">febr2sp</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot</span>();<span class="kw">box</span>();<span class="kw">grid</span>();<span class="kw">axis</span>(<span class="dv">1</span>);<span class="kw">axis</span>(<span class="dv">2</span>)</code></pre></div>
<p><img src="febr_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>Um argumento compartilhado por muitas das funções do pacote <code>febr</code> é <code>stack</code>. Esse argumento permite que, ao descarregarmos duas ou mais tabelas de dados, as mesmas sejam empilhadas, formando uma única tabela de dados retornada como objeto de classe <code>data.frame</code>. Contudo, é bastante comum que os conjuntos de dados utilizem sistema de referência de coordenadas (<code>crs</code>, do inglês <em>coordinate reference system</em>) distintos. Esse é o caso de <code>ctb0003</code> – coordenadas geográficas – e <code>ctb0036</code> – coordenadas métricas (veja figuras acima). Portanto, antes de empilhar a tabela <code>observacao</code> de ambos os conjuntos de dados, precisamos padronizar o sistema de referência de coordenadas.</p>
<p>A padronização do sistema de referência de coordenadas requer que seja informado o código do sistema de referência de coordenadas desejado por meio do argumento <code>standardization</code>. Esse código deve ser conforme definido pelo Grupo de Pesquisa Petrolífera Europeia (EPSG, do inglês <em>European Petroleum Survey Group</em>). No exemplo abaixo, <code>EPSG:4674</code> é o código do SIRGAS 2000, o sistema de referência de coordenadas geográficas oficial do Brasil – mais informações e códigos podem ser encontradas no endereço <a href="http://spatialreference.org/ref/epsg/" class="uri">http://spatialreference.org/ref/epsg/</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2001</span>)
febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/observation">observation</a></span>(
  <span class="dt">dataset =</span> <span class="kw">c</span>(<span class="st">"ctb0003"</span>, <span class="st">"ctb0036"</span>),
  <span class="dt">stack =</span> <span class="ot">TRUE</span>,
  <span class="dt">missing =</span> <span class="kw">list</span>(<span class="dt">coord =</span> <span class="st">"drop"</span>, <span class="dt">time =</span> <span class="st">"drop"</span>),
  <span class="dt">standardization =</span> <span class="kw">list</span>(<span class="dt">crs =</span> <span class="st">"EPSG:4674"</span>),
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, observacao_data, coord_sistema, coord_x, coord_y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dataset_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 6 x 6
## # Groups:   dataset_id [2]
##   dataset_id observacao_id observacao_data coord_sistema coord_x coord_y
##   &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;           &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;
## 1 ctb0003    sm-dnos-304   17/07/2009      EPSG:4674       -53.8   -29.6
## 2 ctb0003    sm-dnos-243   21/03/2009      EPSG:4674       -53.8   -29.6
## 3 ctb0003    sm-dnos-087   18/02/2009      EPSG:4674       -53.8   -29.7
## 4 ctb0036    ACC-5006-2008 xx-xx-2008      EPSG:4674       -53.9   -29.7
## 5 ctb0036    ACC-4005-2008 xx-xx-2008      EPSG:4674       -53.9   -29.7
## 6 ctb0036    ACC-7004-2008 xx-xx-2008      EPSG:4674       -53.9   -29.7</code></pre>
<p>A data de observação (<code>observacao_data</code>) é outro dado que geralmente requer padronização antes do empilhamento das tabelas de diferentes conjuntos de dados. No caso de <code>ctb0003</code> e <code>ctb0036</code>, além de serem usados formatos distintos para o registro da data de observação – <code>dd/mm/aaaa</code> e <code>dd-mm-aaaa</code> –, o segundo possui registrado apenas o ano em que as observações do solo foram feitas. O sub-argumento <code>time.format</code> serve para padronizar o formato dos registros da data de observação – mais informações vide função <code>as.Date</code>. Ao padronizar a data de observação, ao invés da classe <code>character</code>, os dados passam a ser da classe <code>date</code>, o que permite que sejam usados em análises que consideram a dimensão temporal. No caso de datas incompletas, faltando o mês e/ou o dia, atribui-se o mês e dia correntes. Isso é necessário para que os dados possam realmente ser definidos como sendo da classe <code>date</code>. Vejamos o resultado da padronização para os conjuntos de dados <code>ctb0003</code> e <code>ctb0036</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2001</span>)
obs &lt;-<span class="st"> </span>
<span class="st">  </span>febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/observation">observation</a></span>(
    <span class="dt">dataset =</span> <span class="kw">c</span>(<span class="st">"ctb0003"</span>, <span class="st">"ctb0036"</span>),
    <span class="dt">stack =</span> <span class="ot">TRUE</span>,
    <span class="dt">missing =</span> <span class="kw">list</span>(<span class="dt">coord =</span> <span class="st">"drop"</span>, <span class="dt">time =</span> <span class="st">"drop"</span>),
    <span class="dt">standardization =</span> <span class="kw">list</span>(<span class="dt">crs =</span> <span class="st">"EPSG:4674"</span>, <span class="dt">time.format =</span> <span class="st">"%Y-%m-%d"</span>),
    <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
obs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, observacao_data, coord_sistema, coord_x, coord_y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dataset_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 6 x 6
## # Groups:   dataset_id [2]
##   dataset_id observacao_id observacao_data coord_sistema coord_x coord_y
##   &lt;chr&gt;      &lt;chr&gt;         &lt;date&gt;          &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;
## 1 ctb0003    sm-dnos-304   2009-07-17      EPSG:4674       -53.8   -29.6
## 2 ctb0003    sm-dnos-243   2009-03-21      EPSG:4674       -53.8   -29.6
## 3 ctb0003    sm-dnos-087   2009-02-18      EPSG:4674       -53.8   -29.7
## 4 ctb0036    ACC-5006-2008 2008-02-27      EPSG:4674       -53.9   -29.7
## 5 ctb0036    ACC-4005-2008 2008-02-27      EPSG:4674       -53.9   -29.7
## 6 ctb0036    ACC-7004-2008 2008-02-27      EPSG:4674       -53.9   -29.7</code></pre>
<p>Nos exemplos acima, apenas as variáveis de identificação contidas na tabela <code>observacao</code> dos conjuntos de dados <code>ctb0003</code> e <code>ctb0036</code> foram retornadas: <code>dataset_id</code>, <code>observacao_id</code>, <code>observacao_data</code>, <code>coord_sistema</code>, <code>coord_precisao</code>, <code>coord_fonte</code>, <code>pais_id</code>, <code>estado_id</code>, <code>municipio_id</code>, <code>amostra_tipo</code>, <code>amostra_quanti</code>, <code>amostra_area</code>, <code>coord_x</code> e <code>coord_y</code>. Contudo, também é possível requerer que sejam retornadas outras variáveis de ambos conjuntos de dados. As variáveis contidas na tabela <code>observacao</code> do conjunto de dados <code>ctb0003</code> foram conhecidas acima. Abaixo são mostradas aquelas contidas na tabela <code>observacao</code> do conjunto de dados <code>ctb0036</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/header">header</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0036"</span>, <span class="dt">table =</span> <span class="st">"observacao"</span>,
  <span class="dt">variable =</span> <span class="st">"all"</span>,
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">t</span>()</code></pre></div>
<pre><code>##                  [,1]     
## dataset_id       "ctb0036"
## observacao_id    "-"      
## observacao_data  "-"      
## coord_sistema    "-"      
## coord_x          "m"      
## coord_y          "m"      
## coord_precisao   "m"      
## coord_fonte      "-"      
## pais_id          "-"      
## estado_id        "-"      
## municipio_id     "-"      
## amostra_tipo     "-"      
## amostra_quanti   "-"      
## amostra_area     "m^2"    
## taxon_sibcs_2006 "-"      
## coord_descricao  "-"</code></pre>
<p>Dentre as variáveis compartilhadas por <code>ctb0003</code> e <code>ctb0036</code> está <code>taxon</code> – além das variáveis de identificação. O código abaixo descarrega a tabela <code>observacao</code> de ambos os conjuntos de dados contendo a variável <code>taxon</code> e retorna uma única tabelas de dados de classe <code>data.frame</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2001</span>)
febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/observation">observation</a></span>(
  <span class="dt">dataset =</span> <span class="kw">c</span>(<span class="st">"ctb0003"</span>, <span class="st">"ctb0036"</span>),
  <span class="dt">variable =</span> <span class="st">"taxon"</span>,
  <span class="dt">stack =</span> <span class="ot">TRUE</span>,
  <span class="dt">missing =</span> <span class="kw">list</span>(<span class="dt">coord =</span> <span class="st">"drop"</span>, <span class="dt">time =</span> <span class="st">"drop"</span>),
  <span class="dt">standardization =</span> <span class="kw">list</span>(<span class="dt">crs =</span> <span class="st">"EPSG:4674"</span>, <span class="dt">time.format =</span> <span class="st">"%Y-%m-%d"</span>),
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select_helpers">starts_with</a></span>(<span class="st">"taxon"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dataset_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   dataset_id [2]
##   dataset_id observacao_id taxon_sibcs_2009 taxon_sibcs_2006
##   &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;           
## 1 ctb0003    sm-dnos-304   PV               &lt;NA&gt;            
## 2 ctb0003    sm-dnos-243   RL               &lt;NA&gt;            
## 3 ctb0003    sm-dnos-087   PBAC             &lt;NA&gt;            
## 4 ctb0036    ACC-5006-2008 &lt;NA&gt;             &lt;NA&gt;            
## 5 ctb0036    ACC-4005-2008 &lt;NA&gt;             &lt;NA&gt;            
## 6 ctb0036    ACC-7004-2008 &lt;NA&gt;             &lt;NA&gt;</code></pre>
<p>A variável <code>taxon</code> dos conjuntos de dados <code>ctb0036</code> <code>ctb0003</code> consiste na classificação taxonômica segundo o Sistema Brasileiro de Classificação de Solos (<code>sibcs</code>) em suas edições de <code>2006</code> e <code>2009</code>. Enquanto em <code>ctb0036</code> a variável <code>taxon</code> se refere à segunda edição do <code>sibcs</code>, em <code>ctb0003</code> a variável <code>taxon</code> se refere à revisão feita na segunda edição do <code>sibcs</code> antes da publicação da terceira edição em 2013. Apesar disso, as classes taxonômicas contidas nesses dois conjuntos de dados podem ser consideradas equivalentes pois a revisão do <code>sibcs</code> em <code>2009</code> não produziu alterações em suas definições. Assim, a informação sobre o ano do <code>sibcs</code> pode ser desconsiderada. Isso permite transformar as variáveis <code>taxon_sibcs_2006</code> e <code>taxon_sibcs_2009</code> para uma nova variável: <code>taxon_sibcs</code>. A nova variável representa a classe taxonômica nos dois conjuntos de dados como se tivesse sido determinada usando exatamente a mesma versão do <code>sibcs</code>. Esse processo de transformação de variáveis, chamado harmonização, pode ser automatizado usando o argumento <code>harmonization</code> – veja o exemplo abaixo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2001</span>)
febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/observation">observation</a></span>(
  <span class="dt">dataset =</span> <span class="kw">c</span>(<span class="st">"ctb0003"</span>, <span class="st">"ctb0036"</span>),
  <span class="dt">variable =</span> <span class="st">"taxon"</span>,
  <span class="dt">stack =</span> <span class="ot">TRUE</span>,
  <span class="dt">missing =</span> <span class="kw">list</span>(<span class="dt">coord =</span> <span class="st">"drop"</span>, <span class="dt">time =</span> <span class="st">"drop"</span>),
  <span class="dt">standardization =</span> <span class="kw">list</span>(<span class="dt">crs =</span> <span class="st">"EPSG:4674"</span>, <span class="dt">time.format =</span> <span class="st">"%Y-%m-%d"</span>),
  <span class="dt">harmonization =</span> <span class="kw">list</span>(<span class="dt">harmonize =</span> <span class="ot">TRUE</span>, <span class="dt">level =</span> <span class="dv">2</span>),
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, observacao_data, coord_x, coord_y, taxon_sibcs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(taxon_sibcs)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(dataset_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">1</span>)</code></pre></div>
<pre><code>## # A tibble: 2 x 6
## # Groups:   dataset_id [2]
##   dataset_id observacao_id   observacao_data coord_x coord_y taxon_sibcs  
##   &lt;chr&gt;      &lt;chr&gt;           &lt;date&gt;            &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;        
## 1 ctb0003    sm-dnos-304     2009-07-17        -53.8   -29.6 PV           
## 2 ctb0036    ACC-perfil-2008 2008-02-27        -53.9   -29.7 Argissolo Ve…</code></pre>
<p>Como podemos ver, o procedimento de harmonização implementado atualmente no pacote <code>febr</code> é bastante simples. Ele consiste no agrupamento das variáveis com base no número de níveis (<code>level</code>) do seu código de identificação, onde o subtraço (<code>_</code>) serve de separador entre níveis. No exemplo acima, o código de identificação da variável <code>taxon_sibcs_2006</code> é composto de três níveis, onde <code>taxon</code> é o primeiro nível e <code>2006</code> é o terceiro nível – o mesmo se aplica à <code>taxon_sibcs_2009</code>. Ao passar <code>level = 2</code> ao argumento <code>harmonization</code>, definimos que a harmonização deveria considerar a igualdade entre apenas os dois primeiros níveis dos códigos de identificação das variáveis. Como nesse nível os códigos de identificação eram idênticos, as duas variáveis foram agrupadas sob o único código de identificação <code>taxon_sibcs</code> e, assim, se tornando a mesma variável.</p>
</div>
<div id="camadas" class="section level3">
<h3 class="hasAnchor">
<a href="#camadas" class="anchor"></a>Camadas</h3>
<p>A função <code>layer</code> serve para descarregar os dados contidos na tabela <code>camada</code> de um conjunto de dados. Como as tabelas <code>observacao</code> e <code>camada</code> possuem estrutura semelhante, a função <code>layer</code> possui os mesmos argumentos da função <code>observation</code>. A diferença está nos sub-argumentos que podem ser passados à <code>missing</code> e <code>standardization</code>. O exemplo abaixo mostra como descarregar os dados da tabela <code>camada</code> dos conjunto de dados <code>ctb0003</code> e <code>ctb0036</code> com as três variáveis compartilhadas entre elas: <code>argila</code>, <code>carbono</code> e <code>densidade</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lyr &lt;-<span class="st"> </span>
<span class="st">  </span>febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/layer">layer</a></span>(
    <span class="dt">dataset =</span> <span class="kw">c</span>(<span class="st">"ctb0003"</span>, <span class="st">"ctb0036"</span>),
    <span class="dt">variable =</span> <span class="kw">c</span>(<span class="st">"argila"</span>, <span class="st">"carbono"</span>, <span class="st">"densidade"</span>),
    <span class="dt">stack =</span> <span class="ot">TRUE</span>,
    <span class="dt">missing =</span> <span class="kw">list</span>(<span class="dt">depth =</span> <span class="st">"drop"</span>, <span class="dt">data =</span> <span class="st">"drop"</span>),
    <span class="dt">standardization =</span> <span class="kw">list</span>(
      <span class="dt">repetition =</span> <span class="st">"combine"</span>, <span class="dt">combine.fun =</span> <span class="st">"mean"</span>,
      <span class="dt">units =</span> <span class="ot">TRUE</span>, <span class="dt">round =</span> <span class="ot">TRUE</span>),
    <span class="dt">harmonization =</span> <span class="kw">list</span>(<span class="dt">harmonize =</span> <span class="ot">TRUE</span>, <span class="dt">level =</span> <span class="dv">1</span>),
    <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, argila, carbono, densidade)
<span class="kw">set.seed</span>(<span class="dv">2001</span>)
lyr <span class="op">%&gt;%</span><span class="st">   </span>
<span class="st">  </span><span class="kw">group_by</span>(dataset_id) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 6 x 5
## # Groups:   dataset_id [2]
##   dataset_id observacao_id argila carbono densidade
##   &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 ctb0003    sm-dnos-240     305.   33.0       1.39
## 2 ctb0003    sm-dnos-176      63.    8.00      1.59
## 3 ctb0003    sm-dnos-062     146.   10.0       1.61
## 4 ctb0036    ACC-12-2007     265.    3.50      1.67
## 5 ctb0036    ACC-1-2007      223.    4.60      1.69
## 6 ctb0036    ACC-13-2007     172.    2.30      1.55</code></pre>
<p>A primeira novidade no exemplo acima é o uso de <code>depth = "drop"</code>, passado ao argumento <code>missing</code>, que serve para excluir as camadas sem dados sobre a profundidade de amostragem. Da mesma forma, <code>data = "drop"</code> serve para excluir as camadas sem dados para uma ou mais das variáveis requeridas – <code>argila</code>, <code>carbono</code> e <code>densidade</code>. Esse sub-argumento é particularmente importante no caso desses conjuntos de dados pois a variável <code>densidade</code> está disponível para apenas algumas camadas. (O sub-argumento <code>data</code> também pode ser usado com a função <code>observation</code>.)</p>
<p>A segunda novidade são os sub-argumentos passados à <code>standardization</code>. Os sub-argumentos <code>units</code> e <code>round</code> servem para padronizar as unidades de medida e o número de casas decimais, respectivamente. Aplicada somente às variáveis contínuas, essa padronização faz com que os dados sejam retornados como classe <code>numeric</code>. (Esses sub-argumentos também podem ser usados com a função <code>observation</code>.) Já os sub-argumentos <code>repetition</code> e <code>combine.fun</code> servem para indicar como repetições de laboratório devem ser manipuladas quando presentes em uma camada. No exemplo acima, <code>repetition = "combine"</code> indica que as repetições devem ser combinadas, e <code>combine.fun = "mean"</code> indica que a combinação deve ser feita usando a função <code>mean</code>, ou seja, calculando a média dos valores das repetições. No caso de variáveis categóricas, a combinação é feita usando uma estratégia que depende do número de repetições: com duas repetições, se seleciona um dos valores aleatoriamente; com três ou mais repetições, se seleciona o valor que aparece o maior número de vezes.</p>
<p>Por fim, como as três variáveis requeridas possuem exatamente a mesma definição nos dois conjuntos de dados, a harmonização foi realizada considerando apenas o primeiro nível do código de identificação (<code>level = 1</code>). Feita a limpeza, padronização e harmonização dos dados, já podemos proceder com a modelagem. Por exemplo, podemos construir uma função de pedotransferência para estimar a densidade do solo a partir do conteúdo de carbono e argila:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lyr <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lm</span>(densidade <span class="op">~</span><span class="st"> </span>carbono <span class="op">+</span><span class="st"> </span>argila, <span class="dt">data =</span> .) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summary</span>()</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = densidade ~ carbono + argila, data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.87922 -0.13271  0.00896  0.16825  0.63947 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.593e+00  2.489e-02  63.997   &lt;2e-16 ***
## carbono     -8.992e-03  8.527e-04 -10.545   &lt;2e-16 ***
## argila       4.657e-05  1.296e-04   0.359    0.719    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.2179 on 294 degrees of freedom
## Multiple R-squared:  0.3118, Adjusted R-squared:  0.3071 
## F-statistic: 66.61 on 2 and 294 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>A função <code>layer</code> também permite padronizar os dados da profundidade de amostragem. Isso é importante no caso de observações do solo que incluem, em sua camada mais inferior, o sinal <code>+</code>, indicando profundidade adicional para além da registrada. Por exemplo, <code>100+</code>, ou seja, a profundidade do solo é de 100 ou mais centímetros. A padronização também é necessária no caso de observações do solo que incluem camadas amostradas não-paralelas à superfície. Tais camadas costumam ser descritas como possuidoras de uma transição ondulada ou irregular, o que é indicado pelo símbolo <code>/</code> separando o valor máximo e mínimo do limite superior (ou inferior) da camada. Por exemplo, <code>52/62</code>, ou seja, o limite superior (ou inferior) da camada varia entre 52 e 62 cm de profundidade.</p>
<p>A presença dos símbolos <code>+</code> e <code>/</code> determina que os dados de profundidade sejam da classe <code>character</code>, dificultando seu tratamento matemático. No caso do símbolo <code>+</code>, se pode usar os sub-argumentos <code>plus.sign</code> e <code>plus.depth</code>. O primeiro serve pra indicar como o símbolo deve ser manipulado, ou seja, usado para acrescer um valor de profundidade ao valor observado (<code>plus.sign = "add"</code>) ou simplesmente ser removido (<code>plus.sign = "remove"</code>). Caso se decida por acrescer um valor, <code>plus.depth</code> serve para indicar o valor a ser acrescido, por exemplo, 5 cm. No caso do símbolo <code>/</code>, se pode optar pela suavização da transição entre as camadas informando <code>transition = "smooth"</code> à <code>standardization</code>, bem como a função que deve ser utilizada para a suavização. Por exemplo, <code>smoothing.fun = "mean"</code> retorna a média do valor máximo e mínimo do limite superior (ou inferior) da camada.</p>
<p>Os exemplos a seguir mostram o resultado da padronização dos dados da profundidade do solo usando uma observação do conjunto de dados <code>ctb0011</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/layer">layer</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0011"</span>,
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, camada_nome, profund_sup, profund_inf) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(observacao_id <span class="op">==</span><span class="st"> "P4"</span>)</code></pre></div>
<pre><code>##   dataset_id observacao_id camada_nome profund_sup profund_inf
## 1    ctb0011            P4           A           0       30/40
## 2    ctb0011            P4        RCr1       30/40          85
## 3    ctb0011            P4        RCr2          85         280
## 4    ctb0011            P4           R         280        500+</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/layer">layer</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0011"</span>,
  <span class="dt">standardization =</span> <span class="kw">list</span>(
    <span class="dt">transition =</span> <span class="st">"smooth"</span>, <span class="dt">smoothing.fun =</span> <span class="st">"mean"</span>,
    <span class="dt">plus.sign =</span> <span class="st">"add"</span>, <span class="dt">plus.depth =</span> <span class="fl">2.5</span>),
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, camada_nome, profund_sup, profund_inf) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(observacao_id <span class="op">==</span><span class="st"> "P4"</span>)</code></pre></div>
<pre><code>##   dataset_id observacao_id camada_nome profund_sup profund_inf
## 1    ctb0011            P4           A           0        35.0
## 2    ctb0011            P4        RCr1          35        85.0
## 3    ctb0011            P4        RCr2          85       280.0
## 4    ctb0011            P4           R         280       502.5</code></pre>
<p>Por fim, a função <code>layer</code> também permite padronizar a forma de expressão dos valores das variáveis contínuas, especificamente, a manipulação do símbolo <code>&lt;</code>, indicador do limite inferior de detecção do método analítico. Por exemplo, <code>&lt;5</code> indica que o valor da variável é desconhecido mas inferior a 5. Assim como os símbolos <code>+</code> e <code>/</code> descritos acima, a presença do símbolo <code>&lt;</code> força a definição das variáveis como sendo da classe <code>character</code>. A manipulação de <code>&lt;</code> é similar à manipulação de <code>+</code>, ou seja, pode ser simplesmente removido (<code>lessthan.sign = "remove"</code>) ou usado para subtrair uma determinada fração do valor do limite inferior de detecção (<code>lessthan.sign = "subtract"</code>). No caso da subtração, <code>lessthan.frac</code> serve para definir a fração do valor do limite inferior de detecção. Por exemplo, <code>lessthan.frac = 0.5</code> subtrai 50% do valor do limite inferior de detecção.</p>
<p>Os exemplos a seguir mostram o resultado da manipulação do limite inferior de detecção dos métodos analíticos usando uma observação do conjunto de dados <code>ctb0018</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/layer">layer</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0018"</span>,
  <span class="dt">variable =</span> <span class="kw">c</span>(<span class="st">"zinco_aquaregia_icpms"</span>, <span class="st">"cobre_aquaregia_icpoes"</span>),
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, zinco_aquaregia_icpms, cobre_aquaregia_icpoes) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(observacao_id <span class="op">==</span><span class="st"> "1"</span>)</code></pre></div>
<pre><code>##   dataset_id observacao_id zinco_aquaregia_icpms cobre_aquaregia_icpoes
## 1    ctb0018             1                  5,00                     &lt;3
## 2    ctb0018             1                    &lt;1                     &lt;3
## 3    ctb0018             1                  5,00                     &lt;3
## 4    ctb0018             1                  2,00                     &lt;3
## 5    ctb0018             1                    &lt;1                     &lt;3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/layer">layer</a></span>(
  <span class="dt">dataset =</span> <span class="st">"ctb0018"</span>,
  <span class="dt">variable =</span> <span class="kw">c</span>(<span class="st">"zinco_aquaregia_icpms"</span>, <span class="st">"cobre_aquaregia_icpoes"</span>),
  <span class="dt">standardization =</span> <span class="kw">list</span>(
    <span class="dt">lessthan.sign =</span> <span class="st">"subtract"</span>, <span class="dt">lessthan.frac =</span> <span class="fl">0.1</span>),
  <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/select">select</a></span>(dataset_id, observacao_id, zinco_aquaregia_icpms, cobre_aquaregia_icpoes) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(observacao_id <span class="op">==</span><span class="st"> "1"</span>)</code></pre></div>
<pre><code>##   dataset_id observacao_id zinco_aquaregia_icpms cobre_aquaregia_icpoes
## 1    ctb0018             1                   5.0                    2.7
## 2    ctb0018             1                   0.9                    2.7
## 3    ctb0018             1                   5.0                    2.7
## 4    ctb0018             1                   2.0                    2.7
## 5    ctb0018             1                   0.9                    2.7</code></pre>
</div>
<div id="conjunto-de-dados" class="section level3">
<h3 class="hasAnchor">
<a href="#conjunto-de-dados" class="anchor"></a>Conjunto de dados</h3>
<p>A última função de acesso é <code>febr</code>. Ela serve para descarregar todos os dados e metadados de um conjunto de dados. O comportamento padrão consiste em retornar um objeto de classe <code>list</code>, onde cada item é constituído por uma das tabelas do conjunto de dados: <code>dataset</code>, <code>observacao</code>, <code>camada</code>, e <code>metadado</code>. Contudo, é possível usar o argumento <code>merge</code> para solicitar que as tabelas <code>observacao</code> e <code>camada</code> sejam fundidas usando como critério a identificação das observações (<code>observacao_id</code>) – nesse caso o item da lista passa a se chamar <code>data</code>. Isso permite que os dados sejam utilizados, por exemplo, para a modelagem espacial. Vejamos como fazer isso no caso do conjunto de dados <code>ctb0003</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dts &lt;-
<span class="st">  </span>febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/febr">febr</a></span>(
    <span class="dt">dataset =</span> <span class="st">"ctb0003"</span>, 
    <span class="dt">variable =</span> <span class="st">"all"</span>,
    <span class="dt">merge =</span> <span class="ot">TRUE</span>,
    <span class="dt">progress =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
dts<span class="op">$</span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">carbono =</span> carbono_dicromato_30min150_mohr <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(carbono_dicromato_30min150_mohr)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/febr2sp.html">febr2sp</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bubble</span>(<span class="dt">zcol =</span> <span class="st">"carbono"</span>, <span class="dt">main =</span> <span class="st">"Carbono orgânico (g/kg)"</span>,
         <span class="dt">scales =</span> <span class="kw">list</span>(<span class="dt">draw =</span> <span class="ot">TRUE</span>)) <span class="op">+</span>
<span class="st">  </span>latticeExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/latticeExtra/topics/layer">layer</a></span>(lattice<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/lattice/topics/panel.functions">panel.grid</a></span>(<span class="dt">v =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">h =</span> <span class="op">-</span><span class="dv">1</span>))</code></pre></div>
<p><img src="febr_files/figure-html/unnamed-chunk-26-1.png" width="672"></p>
<p>Um detalhe importante da função <code>febr</code> é que ela aceita os mesmos argumentos e sub-argumentos das funções <code>observation</code> e <code>layer</code>. Isso significa que, antes dos dados serem retornados, é possível solicitar que passem por uma limpeza e padronização. A exceção é o argumento <code>harmonization</code>, uma vez que se aplica apenas aos casos em que mais de um conjunto de dados é descarregado: a função <code>febr</code> permite descarregar apenas um conjunto de dados por vez.</p>
<p>Depois de descarregados, os dados de um conjunto de dados podem ser escritos para o disco rígido usando a função <code>febr2xlsx</code>. No caso da função <code>febr</code>, que tem como saída um objeto de classe <code>list</code> composto por vários objetos de classe <code>data.frame</code>, a função <code>febr2xlsx</code> faz com que cada <code>data.frame</code> seja escrito em uma planilha individual do mesmo arquivo XLSX.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">febr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/febr/topics/febr2xlsx">febr2xlsx</a></span>(<span class="dt">x =</span> dts, <span class="dt">file =</span> <span class="st">"ctb0003.xlsx"</span>)</code></pre></div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#apresentacao">Apresentação</a></li>
      <li>
<a href="#uso-do-pacote">Uso do pacote</a><ul class="nav nav-pills nav-stacked">
<li><a href="#funcoes-estruturais">Funções estruturais</a></li>
      <li><a href="#funcoes-de-acesso">Funções de acesso</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alessandro Samuel-Rosa, Universidade Federal de Santa Maria.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
